# Migration `20200817060942-4`

This migration has been generated by Wanseob Lim at 8/17/2020, 6:09:42 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Bootstrap" DROP COLUMN "utxoTreeIndex",
DROP COLUMN "withdrawalTreeIndex";

ALTER TABLE "public"."Config" DROP COLUMN "maxUtxoPerTree",
DROP COLUMN "maxWithdrawalPerTree",
ADD COLUMN "maxUtxo" text  NOT NULL ,
ADD COLUMN "maxWithdrawal" text  NOT NULL ;

ALTER TABLE "public"."LightTree" DROP COLUMN "block",
DROP COLUMN "treeIndex";

CREATE UNIQUE INDEX "LightTree.species" ON "public"."LightTree"("species")

DROP TABLE "public"."NullifierTree";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200807022435-3..20200817060942-4
--- datamodel.dml
+++ datamodel.dml
@@ -5,9 +5,9 @@
 }
 datasource postgres {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 model EncryptedWallet {
   id String @id @default(uuid())
@@ -38,10 +38,10 @@
   nullifierTreeDepth Int
   challengePeriod Int
   minimumStake String
   referenceDepth Int
-  maxUtxoPerTree String
-  maxWithdrawalPerTree String
+  maxUtxo String
+  maxWithdrawal String
   utxoSubTreeDepth Int
   utxoSubTreeSize Int
   withdrawalSubTreeDepth Int
   withdrawalSubTreeSize Int
@@ -86,12 +86,10 @@
 model Bootstrap {
   id String @id @default(uuid())
   blockHash String? @unique
-  utxoTreeIndex Int
   // utxoBootstrap String[]
   utxoBootstrap String // jsonified arr : sqlite does not support arr
-  withdrawalTreeIndex Int
   // withdrawalBootstrap String[]
   withdrawalBootstrap String //jsonified arr : sqlite does not support arr
   block Block? @relation(fields: [blockHash], references: [hash])
 }
@@ -175,24 +173,13 @@
 }
 model LightTree {
   id String @default(uuid()) @unique
-  species Int // 0: utxo 1: withdrawal
-  treeIndex Int
-  block String?
+  species Int @unique // 0: utxo 1: withdrawal
   // rollup sync data
   start String
   end String
   // rollup snapshot data
   root String
   index String
   siblings String // stringified str[]
-  @@id([species, treeIndex])
 }
-
-model NullifierTree {
-  id String @id @default(uuid())
-  treeIndex Int @unique
-  block String?
-  root String
-  siblings String // stringified str[]
-}
```
